<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/blog/app.74bdf83e79269eca4caf.css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/blog/static/montserrat-latin-100-4124805c0503dbfe42dd67d7f5715964.woff2) format("woff2"),url(/blog/static/montserrat-latin-100-c8fb2f714bbc7bc3e8dfffa916b286dc.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/blog/static/montserrat-latin-100italic-e4bf47bd171a9b2a72dd84c58bf90edf.woff2) format("woff2"),url(/blog/static/montserrat-latin-100italic-d1f3f2d02ee4d7d2d4b1ad865014f189.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/blog/static/montserrat-latin-200-444ae007121264bc1969d49b4031f9b2.woff2) format("woff2"),url(/blog/static/montserrat-latin-200-edbce16a90aa22c297a0307b85789837.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/blog/static/montserrat-latin-200italic-f316c5d1ec40f3e68654c3f38b3999f3.woff2) format("woff2"),url(/blog/static/montserrat-latin-200italic-d7bbb730d9b5e11720b3eb32326dcca7.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/blog/static/montserrat-latin-300-0a7c6df06e85d978d096d4d18fd8d43d.woff2) format("woff2"),url(/blog/static/montserrat-latin-300-5e86df2cad22d2ef2b03516334afae5e.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/blog/static/montserrat-latin-300italic-c076c4892bc7a4be7b9097e97a35012d.woff2) format("woff2"),url(/blog/static/montserrat-latin-300italic-37c74a8d2d0d36a0a2c6e9a37ee15b0c.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/blog/static/montserrat-latin-400-501ce09c42716a2f6e1503a25eb174c9.woff2) format("woff2"),url(/blog/static/montserrat-latin-400-f29d2b8559699b6beb5b29b25b8bc572.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/blog/static/montserrat-latin-400italic-882908d9950d9c86ebd380877f293d95.woff2) format("woff2"),url(/blog/static/montserrat-latin-400italic-22e7b04e5f2a901d49d4d342315a715a.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/blog/static/montserrat-latin-500-f0f2716c5fe401d175b88715e7d28685.woff2) format("woff2"),url(/blog/static/montserrat-latin-500-991b453bf90a0980e78966d2af7e3d3a.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/blog/static/montserrat-latin-500italic-4590ebba421b3288c305305d7fa7b504.woff2) format("woff2"),url(/blog/static/montserrat-latin-500italic-f3d41e4cdcc2314e49ddcea751d6f87f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/blog/static/montserrat-latin-600-15c24f7109941777774ddd2c636c6a50.woff2) format("woff2"),url(/blog/static/montserrat-latin-600-f6dc6096f48956908c1787d9a722570a.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/blog/static/montserrat-latin-600italic-6d10b80529d5c36c7c09fca7193af0fc.woff2) format("woff2"),url(/blog/static/montserrat-latin-600italic-02c4833312d94b1b0866f073023a250e.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/blog/static/montserrat-latin-700-79982cd1f74c6fa7451bf9b37ead09ff.woff2) format("woff2"),url(/blog/static/montserrat-latin-700-957e93fbbe131a59791cd820d98b7109.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/blog/static/montserrat-latin-700italic-283438e9577fe6a684466bb100e105ec.woff2) format("woff2"),url(/blog/static/montserrat-latin-700italic-ca627c5ccc65cf80c2ecaea44b997de9.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/blog/static/montserrat-latin-800-35386154b78d046218fc8f88a44ff515.woff2) format("woff2"),url(/blog/static/montserrat-latin-800-756655905d91b77960888262e7d58d35.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/blog/static/montserrat-latin-800italic-e1b52a7bd83e2324db6d92bdc206844c.woff2) format("woff2"),url(/blog/static/montserrat-latin-800italic-a69f0add9d86c1a84311d7dd8693ba4a.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/blog/static/montserrat-latin-900-260c2ea3ef57feb82251952e605a36d5.woff2) format("woff2"),url(/blog/static/montserrat-latin-900-186cae8091da578150d81958e217714a.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/blog/static/montserrat-latin-900italic-d785fb9fc74588ffb7f306799709a97d.woff2) format("woff2"),url(/blog/static/montserrat-latin-900italic-43b527fe77254f97ea36e2b54e845ec4.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/blog/static/merriweather-latin-300-a50c381443e6993188ed9cc4b6806866.woff2) format("woff2"),url(/blog/static/merriweather-latin-300-2c73b119ad85e697123658b8a091ff83.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/blog/static/merriweather-latin-300italic-bd410cbf8c272acd4fbdd9f61a7015bf.woff2) format("woff2"),url(/blog/static/merriweather-latin-300italic-9deeb422b65afb1daacc039296bb3640.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/blog/static/merriweather-latin-400-f936cb550d4dcd769f75c453207ac5e6.woff2) format("woff2"),url(/blog/static/merriweather-latin-400-ab0616e6d856817eff54eb8c5e1664e4.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/blog/static/merriweather-latin-400italic-5c9a23d08e2c851e5a25795b940acd4f.woff2) format("woff2"),url(/blog/static/merriweather-latin-400italic-0ab4b54f3b1e8b14cf755970fde8ce35.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/blog/static/merriweather-latin-700-1636f13a52ca3f0eb8784c9c57f62082.woff2) format("woff2"),url(/blog/static/merriweather-latin-700-cc673c945b482dc1378d4a3c95ffd175.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/blog/static/merriweather-latin-700italic-8b0db67123584893c6591accbc51640c.woff2) format("woff2"),url(/blog/static/merriweather-latin-700italic-513649f5b9ba4675cff15cf3f7ad4f2a.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/blog/static/merriweather-latin-900-46631a9aab93dec3ed34f429dd1a5646.woff2) format("woff2"),url(/blog/static/merriweather-latin-900-a0528570caa2c785891308ce604d8db7.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/blog/static/merriweather-latin-900italic-a26a8168916e5d4e5485081171d7fdb0.woff2) format("woff2"),url(/blog/static/merriweather-latin-900italic-db42a3f34378e69ef5aebb6717f1f33e.woff) format("woff")}</style><style data-href="/blog/0.b6f197430f783b3e67aa.css">code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#f8f8f2}.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><style data-href="/blog/component---src-templates-blog-post-js.29ce2abb0b0bffc87cdf.css">.gatsby-highlight{border-radius:.3em;margin-top:-1.5rem;margin-bottom:1rem;overflow:auto}.gallery{display:flex;align-items:center;justify-content:center;flex-wrap:wrap;margin-bottom:1.75rem}.gallery__item>img{margin-bottom:0}.gallery__item>label{font-size:.75rem}.gallery__item{display:flex;flex-direction:column;align-items:center;justify-content:center}ul{margin-left:1.75rem}li{margin-bottom:.5rem}</style><meta name="generator" content="Gatsby 2.0.91"/><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml"/><link rel="shortcut icon" href="/blog/icons/icon-48x48.png"/><link rel="manifest" href="/blog/manifest.webmanifest"/><meta name="theme-color" content="black"/><title data-react-helmet="true">Offload heavy computation I | Canastro&#x27;s notes</title><meta data-react-helmet="true" name="description" content="At  dashdash  we build spreadsheets with super-powers, we aim to create tools that make computation accessible to everyone. Our spreadsheet supports most of the…"/><meta data-react-helmet="true" property="og:title" content="Offload heavy computation I"/><meta data-react-helmet="true" property="og:description" content="At  dashdash  we build spreadsheets with super-powers, we aim to create tools that make computation accessible to everyone. Our spreadsheet supports most of the…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Ricardo Canastro"/><meta data-react-helmet="true" name="twitter:title" content="Offload heavy computation I"/><meta data-react-helmet="true" name="twitter:description" content="At  dashdash  we build spreadsheets with super-powers, we aim to create tools that make computation accessible to everyone. Our spreadsheet supports most of the…"/><meta data-react-helmet="true" name="keywords" content="javascript, heavy computation"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:#fff;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:#f1f5f7;font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#f29d0b;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}h2, h3, h4{color:#fff;}a.gatsby-resp-image-link{box-shadow:none;}</style><link as="script" rel="preload" href="/blog/0-e48695d5871324b71e93.js"/><link as="script" rel="preload" href="/blog/component---src-templates-blog-post-js-dfae161cbd4cc5cee727.js"/><link as="script" rel="preload" href="/blog/app-71bb5c1e51537a9caa47.js"/><link as="script" rel="preload" href="/blog/webpack-runtime-34eb4a7240d1c4477f59.js"/><link as="fetch" rel="preload" href="/blog/static/d/252/path---offload-heavy-browser-computation-1-b-0-1da-hY1QFXnplce0NeeIM5Xjj5FZmQM.json" crossOrigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><style data-emotion-css="1rnu16q">.css-1rnu16q{margin-left:auto;margin-right:auto;max-width:52.5rem;padding:2.625rem 1.3125rem;}</style><div class="css-1rnu16q"><style data-emotion-css="1kt71xu">body{background:#222222;color:#f1f5f7;}</style><style data-emotion-css="ll7al5">.css-ll7al5{font-family:Montserrat,sans-serif;margin-top:0;margin-bottom:-1.75rem;}</style><h3 class="css-ll7al5"><style data-emotion-css="yckaeb">.css-yckaeb{box-shadow:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;}</style><a class="css-yckaeb" href="/blog/">Canastro&#x27;s notes</a></h3><div><h1>Offload heavy computation I</h1><style data-emotion-css="7nkz9f">.css-7nkz9f{display:block;margin-top:-1.75rem;margin-bottom:1.75rem;font-size:1.5rem;}</style><strong class="css-7nkz9f">Use CPU&#x27;s idle periods</strong><style data-emotion-css="k008qs">.css-k008qs{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}</style><div class="css-k008qs"><style data-emotion-css="6u5jsx">.css-6u5jsx{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:1px solid #f29d0b;border-radius:5px;padding:0 5px;margin-right:5px;}.css-6u5jsx:hover{background-color:#4c5156;}</style><div class="css-6u5jsx"><style data-emotion-css="lunbwq">.css-lunbwq{box-shadow:none;font-size:0.75rem;}</style><a class="css-lunbwq" href="/blog/tags/javascript/">javascript</a></div><div class="css-6u5jsx"><a class="css-lunbwq" href="/blog/tags/heavy-computation/">heavy computation</a></div></div><style data-emotion-css="14obzgu">.css-14obzgu{font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem;}</style><p class="css-14obzgu">January 11, 2019</p></div><div><p>At <a href="https://www.dashdash.com">dashdash</a> we build spreadsheets with super-powers, we aim to create tools that make computation accessible to everyone.</p>
<p>Our spreadsheet supports most of the standard excel formulas, external API integrations and some dashdash specific functions that allow you to integrate any API through GET and POST requests (learn more about dashdash in our <a href="http://dashdash.com">landing page</a>). Given this flexibility most of our computation has to be done in the backend, but not all of it. For the formulas that do not require HTTP requests to be fired, we could do them in the frontend.</p>
<p>Currently we do all the computation on the backend, that means that even the “trivial” operations such as arithemetical operations need call our API. These are operations should feel immediate to the user. Nobody got time to wait ~80ms for a <strong>sum</strong> result <img class="emoji-icon" data-icon="emoji-smile" style="display: inline; margin: 0; margin-top: 1px; position: relative; top: 5px; width: 25px" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAWcElEQVR4Ae2bBZAjR7auv5NZpRI0z0xPu8ft4RnzwsCu2cvMaNi3cJfxMjMzMy8zM7PtZ2Z7mLlJ6m5JparM81RSRaxiwtNm+9GJ+COrQ1WnzvdnprJSLQn/j4f5/wb8vx3/34CARzl+G8zVV7MmUM7DcI4I6wTGjJUhoAIALHinswpHVdmJ565UuONDH2I34HkUQ3770YGW3VeyhYCXFAzPkYKcbUNTMgWDKQhiBKzQGzhFveJbmTwu8Q1t6d0tz9dJ+fyaj3ADoI+4ATyCceOLKC8Z4tUm4KcKkbnQlowxZYuJMnCPSFvWdw0wPTgCeDoGqDOoGnyrrdjj6w7X8L4V+2t8yn9MzfIJoP6IGdAu+mHH3BzBqgmuDgL5+ULZnGP7A0zFYIsOkwFnBpSGsIPjUBlD+k5HCgMYGwHgXYy2auj8QVg4iqsexjdm0cwAZ3BNi1/wuLmUVt3flab653sP8CEgfdgGfPdyHlaMj7O1WOCPihX79GAwIBiwSCHBREIwdDpmfGtbFyL9Z2HKS1FbBjEgCuoBun+rgHrE1fH1SXTuHvzha9q6nnT2ID5WtBWS1hxpNaW54L7TbPErwPUPy4BtV/KQYuNHkN1X8bNRRX43GgrLdigkKCeYohCMnY9d81Ls2MVocQR8Cr4FmoD3gIKcNAU0PzAGJARTABMgzWnc0R/hdn+O9Ojt+KaS1kPcbEI8m9TjBf3NNR/mLwF9rN4D5MZXMbCsxN8X++3V4dICwaDBRjHB8vXYM1+PPe1y1BhIF8AniAgPJVQVTAhBBfEed+R7uHvfT3psBy6OSKueZLJFc8596ESDd2/+JDVAHyUDcviXM7Z0kI+WB4LLwuUFgn4lKAvBhhdj1r0eCfshrSLqQeSh3U052QlUDASDaDKH39k2YfsXSOtKOickx1rUa+n3J6tcsfkzHH0wJgQPFn50gC8WR8JN0bII2+cIhgYJzvspzPgzIZlD4qMg8sDAeOCGiAJxA6SAPfNtyMBa5I7/QKSKMUUI4stGNfliu8YX9ZrwSBkgX3sOw234jxeXtOHHImy/Eg6OED7xfTByDhIfAT15bvPIRA+K+Bj8PGbsQgqFQeTWv4FglshGAJtGST7ervWlz/06M4A+EgYIYM4c42+Lw8El0WiEHYBwqJ/gvHciA6uhcQREeuEfNQMA8CBpHdr3Dp7wTrjj70DmiXwEXi85U9O/BV4PeEAfugE5/Par+dnSgL0qHC0QDBmCPiFc/2roOwPiY114fQSBH6gh8TGkXUOnlnvej6B4X6CU6lXbr3a3bfgQf3l/JgT3B3/Nq9hUKctvZ+/24WABW06xE5fDknMgOd7lzuFRHrtQUOjUkNViJy5B932P0BXQllKJm799zav0+xd+kpsWMyFYDP51yymu6OPP2/O+HA6HBH1gh8cxoxdAawY0RQRAQHhsQ0FQVAGfdGqyte2gx9E0RJuuvCJp/Xmb4XkfPEaz14QHbMCvPZPXlPrtJUEb3vaFmKLHjG4CA6RzXXgRHs8QzU2wZczoFrT+lU6twbCjtOAu+bVnutd88MN8ENAHZkAO/ytbGahE8ssd+P62imD6lnWe40lnERzoY93zi4yENEb6xjs12nQK3981oTLvf/lXturn/+h6qr0mLGaAAewV63hFNGDXBwMBptRWQZGBlaAO8Y3HsecXGQmm1KnR1Kc6NWe1RwPp+ivWpa9oG/D+HN4tZoBkesoIUX8kbw4GLKYSYIsGiSxSGkHcPGgK98cvQDGA0ELTQZKCPlAaIAygaCFx0HwA1yqIOshqjArY1OErARlDf9W9+Skj+rH/OY0DBNDFDLB/dBlPKlVkk+3Let9iCoIUyogJIa2DeBaN0EAl5Piu4xw6Ms/GdcOUx/qg2gK9HxIRGCxQPzrDtp0zrDitj9G1w7CQQOJZNNRkNXZqNcl8p/aMoVRJNv3RZfqkp3+W6wC/mAEGsGMV85Kwz3Y+zLAFiwQGwhKQgGa6H/hCyL/+/Q189NPbaMYwNGT42bdt5lkvWQczMaieGn4o4pufv4u//JcbmZ31FCO44hUbeevbngz+AZggYadWCeqd2l3ZkrGMVXgJ+BsAB/j7MkAAs2aYsBTp06XzSY5FQoMEYGwIrgmaLD50y0Xe/2838tGP7+DsVYZKZJmsJvzhX13PUB9suWwFzJ4ix1DIDd/e2Tl39TI4bzxkIXbtXNuIAs/r33IezDYX7wB1nVp9QFZ7hyFjKUXp0zO23TOkgAB6nwb81ibWREXZaEu2M+9NZoC1gAMfg1/EgErA0XuP85kv7GDT+oDRAUsYwEglIjAx//T+O9lyfgWMh5aD3k1DwcKM6ZyzfjmsGYuIQkhSQyl0nZzPuWQ5YysrsJByyjAecIgNMKHrMGQsGdNvbdI1r/8W9yxmgJ3o57ygaIomMhgrkEkEtAl+AfTklUS6EiD0fOW7e+kLYfmgpVIUrIEogJWjEbfsbnDNNXdz4cUVaOYdAYBCIWi/tkBtqsGT1kQMlARrwYUgYjkylXZyv+kt64EUFOA+avGtbq3Srd1kigwZ00S/Pw/YDsgpp8BQyZxtI0HCtqxBjLRlQBNIqmBKJz2PpuATkBbMeu68e5Lx4YAoEDTxxE6xoaUcwUifcNM9MRde2g8SQG8Y03ktOyc7Vz3EscNaIQpMJ2eWm9kSJAa0ACYECXp5wMegSVZzW77LEAoZU8YG/rO9Fxig99hEga6VwCA2k4AxIHkvp/NdE9I5SGuQzEAyC24epMVCzVOb8ZSLQrWaUEsEhkvM1ByNhZShsuXgkVYXwAiQywgkpvNadk52bnZNdm0t6ebKcma5s3sgre49k9luDWktqymvrQbko9Z0GLosgSFjI+c8eQRILhsKowQC2YVic3gDCgBoTB4gBpCurGF6zuG9UptN2bh1CVf80kYGRwscuHeeD/z+PTSnF/DGQgIYwPdYn8DCvMfUU3S0wut//SwmzuyjerzFR/9kG9uun8Jr0L6HUukPoJVfrB5ontSP5Cb4LoMVCIQOG9geXjWc/PgRMCT5vCdQBNBMqj036DElFznPdBtehoq89VfWMVidhR/vZWKwxRt+eQMzTajXPQgnB0j3teyc7NzsmuzaLEeWK8uZ5fanWP9VJW9pS3sWegURMqaMDQgXfQ8QQ6ktROgm84KogvSaoLl6MiWe4ZGAeW944etOx2Twhxpd97fPsmLDIFuedxrX/3gGSkC1ByUFBi0ta9n6vKWsWJLC9ioYgUPzGOM6Of/wd3YzPGx7nypR6DnuDQUvaJcfMR2VAHOyAb0cxggoCkoujyqQJwLoZj3JugQGBuDvP3Q2Zw4qHKlBKPmFwP4ab3vDEl708iUQz4P3YAAAD7QSfu+v1jE+AOyt5QNVwQBH6jx90wDjHzybAdOEmkelB1w5CQPy2nvMUYwAuQG5NKDXPDCpp4kD9R40RVUQzVMAQs6fg/XeWxYabXgHxxMU7bEVcEpUrbK6aGE2geCkadt0rB6ah1mHege2J7mCHK9y5kAIMy0UgF54unX2jAhBUHVoxuA8OOiwgSG35z73AqmjmsGrS9FUQMkS5TDd6WAChYoB5yFRcIDJi5mJQch7sEeAtkBiwJ7iKbIWowDhSTNNQD0w2wQjSI6ABSkIYGDe47ygyE9c8R5c0mVxnoxtsc8DFCBOmcwMwDsUg3qD8JOhJKESNz0/+FHKmpXC2g0W+hUUJAFaQKp54V2pPMBvI5jeSkAE8IDJTQsEirlBHpgSbr4xpdEULtoUYEVIUwEAJf9nq+uyqO+wnWo3qLmotmTfeJJdqJBPA7ygBgTpwP7Xhxv8zr/HrO0T1qwynHuOYdP5lg0bhIkVAgNAJCC5MQo4oKfNddI7UM/KanrAvcCCks7B7u3KPfcqN9+acvc2z959nhMpfOYfKjz5SSHM9UwN7biApoom2mED5VRTQIF0X83v2tiyeKd47zFq8vme90goYIXzysLEiDK53/HFOx2f/HhCuQLDIzBxhnDGhGFiAlasEEZHYXDIUCpDMYLAgo1yOAVSSGNIHTTqUF+A6VnP8aNw4JBy8BDs2+84dACqVUia0G9h6QA8YYWw+zg4q2AdYgQ8AHglY+iytCBjA9yptsMeSH98hN3PWO9jEh+pM6j3gCAGVDw4WH8WVApK39I+1r/0BcxVaxzZeRszRydZqLa48TrlBz92SE8HF0Ko9EFUBGuhUITQggeSVlfOZfBdExIHpmcGlCPoG4HxVSVGJla02/MJ0jqHfvQ1RgbhjDO0m0AMGAFHPgUUUo+LfZyxAQngT2VA8oG7OPizW9lVjPVsTToWohgEEAMknvXrIRFoLTmdzVf8Csa18EmdNElYmNpP9cQx6rVppg7eydzxGer1Bo1GlcbsVBtuHk2h2YS5GAAKZbARFAJhZMUQ5YERiuUBypWIofFxhsbOotzX324nKA4sJyyEmKifqSMHuPW7X2fkNGX5qMC8glFIQSVfwluKj5X5JrsytsUMUCBeSEiOVeXaJR0DAO05XYAWneG9dDXcefe9POPQdk4bX4W3AQPlCivGT6dQLBKGBYIwwBiLCQI0iXHJPGnSQsiXKdcz31EUJShUsJkjYnHO4dtKkhZJKyFu1NtGzneOI2s4sP1mdh1VXnNZAP2K1gDJlXZRNQVtKBnTQtIhigE9lQEJ0PjGPv/DDRPmjUFTjYvBFBW0Z/npU55yecgNf5fwlU//K2981+8zsmw5olnBCWlzAXEtjC904AMpEBYjosFBgsyYQDD0BjiFNHUkcYs4abbbGE2SDqxLWvg0JTDCwMAQHsPe3Tv42qf/DTFw2TMtxKAGRMFrN6FzoE0lbarPmIAGkCz2kZgH6n99E9uuOF/vGqv782xL8C2DLQgYUASZU174goDPfyrhru9/i1+/+2bOf8qzueDS53HO+ZsYHR2j0Aa11uB9iihYYzvmODyiARKGCDm8c6RpSpKkKBBYi4kiClGJPmNJnaPeaHJo/15uu/k6rvvBV7n7lm9jaynnP9Hw1C0GpkGMoB148KmiTY9reKZqelfGBNRzRhYzoFFLaNx2SD+7fKk/T5sGKuTrKojtLkkTZwpPe1aBW7+fEOs0137pY3zrsx9jeHSQVevP50mbL2L1unPZcPb5jI9PUCqXKEaW+wprbUdRGxpgbqHZBp5n3+672bH9XnbcfRO333ItB3beQWPeMVyCdUsgiQ2veG0BCkACiICnI3WgsaJznowlY4JMixug+Um1X/sR39864fcvGfRnmJJgSiCRAaMgArPK/3h7yN6bHGNDhvNPg5lWyrFqlaN3/pAPX/tDEg9hCfoGBhhZupzR8ZUsXbaCqFShUu6j1Ab2CgvNBZr1OgsLVSaP7uf4kYNMTx1vwzZIY6iEMDIAZy+H5WssA6GhMaVwrvDCl1k46tFA0A64oLHH1z1uzjM74/dnLEANaDyQf4ykwNyuKnPXHdD/fu6Q/01bMfgSmAgIBASYg9PWwvN/qsCP/qPFhrWWVUFIc4nScDCXeubjtlrKXKPG/EyN/Yd3sK0FqQPvQRXId2oBEIRQKkBfCZaPQN849EeG/oKlEkA5gIII9bqyzSvv+IUIvIITBAEvaAK+CW5ecbOejCFjgY5SgPszQIF5YPYd3+b71435W07rd0+SsmDKYEIDVhALHFFe9LqAfds8x25LWbfKMhwKXsA5S6KG1EPL020VnFdSBd+z4bSZBIwIgckgITR0j7NWpK38DaoJB454nvXmAhufJLBLQQTN4FMg7s77tOo4dsLfkjEAsznTA/7naAzMVpsM/stt+ve/POj+QUqmKJEQBh5jDQQgqcCM422/U+Cvfgb2HnGsXWmJClAERASlZ2+iiiKo0hG9O0nA5C0IInSVX+88nZ7fvt9z9ktCXvD6AHanIIZ854tvepJ5bcN74mnXzGpvM9SA2ZyJB2qAAjVg6q9vZNflE/Ifl5bcu2wk+IJBAg+BdE2oQRg53v2XEf/yay127Had/UE5AmvBmBxKe0jhPjpD6N2VaH7sgNRBta7s3OfZ+KKQK38mhH0ppKZrZgLa9PgFxVc9bspx3R75j7++UXcBUzmLPhgDAFrADFB+6Wf952/ol/XrwvTZhAFgMEYwQd5bU0p5meN9bRM+8lct7vlewqrTDEPDQiTQ8wlTD6os/k2YfC8Wt+DYMeXInOfStxV5xqsN7Emhkb/pJeDr4GtKMuNpnUjZdcB/46Wf1c8DkzlDC+DBGqDAHDANlF73Jf3Xz73SL19u3RPI56hYg5TzneIJMHHK1b9a4IYtAd95f8yJPZ7x5UJfn1AIQSyYU3yfQiF/iMnBE6jOKodPePrXBrzht4usXg/sdBBLB5xU0KzXa74Dnxx3HD/sb8tqzcGncwblFGFZPBRwAJMN7E1HuPNZ43puybCUQBBDDpMftEBmPSvOEzY9r0BcEHbt8EweU+JWl1pzgeAQFMEjJB6aMdQW4Ogxz+EpRUctF7++wMvfVmA4dLDXoS2BtjQW/ILv9vy0JznWhj/ktr3xi/oHtx7nEHAkN6D1SHxRsh9YDqy4YJzxf3++/OL4GeaJ4ViAHTQE/YL0GaQAEipigUFgPCCNhTtv8dxzTcrkbk+r5pEUggCMATw4n+/+ihCNWE4/y3DWBQEbzhGIHRzy0OAn63wdtOFJa4qrepKjKYcP+Fvf/BX902sPd+APA8eAuUfym6LDwCgwtn6QpR99qbx1zRnm2eEyix02uQmCiQTaEquIya1baqBicU2YnFRmJ6E26WnFCkCpTxhcZhgeEUaWAVZhxsEJhSaogqYCieKbis4pab7OJyccO/f7b175Rf33ndMchY5O5FOAR9IAyU1Ylo+GgU+/3Dz/wjX6ptJSGwVLLHZAsP0GKYIUpC2QAATAAiWBPiASKAhYACDJpNBQmFeIAZeDe9AYtKVoA9y8x9WUdNrRmHTxNbvlP1/xGf9VYDbv9RP5sT7SBgCYfHAvzY0Yee8mVr99k7xhbMw82Y4YgiGDqQimbDAlkDCTgAEJslZBQE76wYT6/G8v+YcYoIm2Bb4Bvu7xC9013k17jh71N//zTfrff3sTu4HpHHwKqAL+Uf22eD6wl+QaLln6/+G5XHj5KnnF0DKzyg6azkgwZUFKgo2AgiAhYEEMvU89ObiiPu/5BIgVF4M2FF/Xbs9XPbMn/N7v7dVPv+trXNNwzOVDfSrXHKCP1U9m+oDBfFoMAYMr+qj8/uVsfuoZ8tylQ3Ju0GckM8GWDRLlUyIUsHRkLAB4B2TSfAfX6rau7jvw6bzXySm987pD+rVf/x43HppnIe/pWWAmP55/PH4zFOWjYSA3oT83JnjPZla/eL3ZvHpEt/T3sTIsmchEAqEgAZigdwTk+/cUSBQfK0nDx3Pz7NszLTd8YYe/8e9uZA+Q5qBzOXwtP44fzx9NGaCUw+eiDFSAyIJ50QZGL51gxcYlZmJpWcfLISNRQF9oKQIkjmacMl9PmJ6sy+FtU/7ADw5w6IvbOe7A54ALQD0HzkUD8P+7/GosyI2o5CrnfxeBQi6by5O3PSY68jZXK1cTaOTwC7kaQPq/28/meo2IgGKuUg7fa4LJ295wgO+Fz9UAmrniXvD/XQ3ozR2epCBvcwMQAEB7DEhyyOQk6aNT5GMXOTQm133th3yu3IxHP/4XO432G6HFG40AAAAASUVORK5CYII=">.</p>
<h1>Frontend Computation</h1>
<p>While most users have simple spreadsheets, we only limit the graph of dependencies of a single cell to 100 000. A power user can easily create a spreadsheet with a insane cell dependencies graph. </p>
<p>Given our large constraints, editing a cell might have a ripple effect that triggers operations in thousands of other cells either directly or by association with other cells. If we execute those operations by iterating each affected cell / formula we’ll completely freeze the browser and provide a terrible user experience.</p>
<h1>Requirements</h1>
<p>Our solution for the frontend computation should support the following requirements:</p>
<ul>
<li>No dropped frames, the page should be responsive at all times</li>
<li>Processing should be interruptable (either because new data was introduced or user wants to leave the page)</li>
<li>UI should be updated only when full computation is complete (we don’t want stale data to be presented)</li>
<li>Should be as fast as possible given the previous constraints (if we split execution in chunks it will take a bit longer to process but the page will be responsive, and therefore the perceived perfomance will appear to be better)</li>
<li>Relatively easy to maintain and to reason with</li>
</ul>
<h1>How to test our solutions</h1>
<ul>
<li>Create a simple example;</li>
<li>Use <a href="https://github.com/sw-yx/async-render-toolbox">async-render-toolbox</a> chrome extensions to have a visual cue of the CPU lag;</li>
<li>Create a counter and a timer to make sure page is still interactive while processing a queue;</li>
<li>Use devtools for some extra performance inspection;</li>
</ul>
<h1>Test case</h1>
<p>A spreadsheet in which A1=99 and each row from A2 to A100000 adds 10 the previous row. A2 will be computed to 109, A3 to 119, etc. A100000 will be 99 + (10 * 99 999) = 1 000 089. As you can imagine, changing the value of A1 will have a ripple effect and 99 999 calcs would have to be done, <strong>sequentially</strong>. </p>
<p>We need to define a datastructure and a traversal algorithm to test our solutions. Since the problem we’re tackling is only related with high CPU usage, we can easily create this scenario without a complex algorithm or data strucuture. Lets not think about possible circular dependencies, cells with multiple dependencies, ranges to select cells and other challenges that we already face on the backend computation.</p>
<p>Given a object with each cell indexed by id, we’re going to start computation by the cell A1 and then get the next child until we find a cell without child.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token punctuation">{</span>
  <span class="token constant">A1</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token string">'A1'</span><span class="token punctuation">,</span>
    child<span class="token punctuation">:</span> <span class="token string">'A2'</span><span class="token punctuation">,</span>
    formula<span class="token punctuation">:</span> <span class="token number">99</span><span class="token punctuation">,</span>
    value<span class="token punctuation">:</span> <span class="token number">99</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token constant">A2</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token string">'A2'</span><span class="token punctuation">,</span>
    child<span class="token punctuation">:</span> <span class="token string">'A3'</span><span class="token punctuation">,</span>
    formula<span class="token punctuation">:</span> <span class="token string">'=A1+10'</span><span class="token punctuation">,</span>
    value<span class="token punctuation">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
  <span class="token constant">A1000000</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token string">'A1000000'</span><span class="token punctuation">,</span>
    child<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    formula<span class="token punctuation">:</span> <span class="token string">'=A99999+10'</span><span class="token punctuation">,</span>
    value<span class="token punctuation">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>In each iteration we’re going to update the value of the cell and then move to the next one.</p>
<h1>Approach</h1>
<p>There are a few possible aproaches that we’ll want to explore and each will have their own trade-offs:</p>
<ul>
<li>Schedule cpu idle periods to compute calculations</li>
<li>Webworkers</li>
<li>Generators (?)</li>
<li>Process only the cells within the viewport, and rely on the BE response for the rest</li>
</ul>
<p>In this blog post I’ll explore one in particular, the usage of cpu idle periods to perform our CPU intensive work, inspired by react’s fiber architecture, and in particular react’s scheduler package. </p>
<blockquote>
<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/requestIdleCallback">window.requestIdleCallback()</a> method queues a function to be called during a browser’s idle periods. This enables developers to perform background and low priority work on the main event loop, without impacting latency-critical events such as animation and input response. Functions are generally called in first-in-first-out order; however, callbacks which have a timeout specified may be called out-of-order if necessary in order to run them before the timeout elapses.</p>
</blockquote>
<p>By calling requestIdleCallback we schedule a callback for the next CPU idle period. In that callback we can check how long we got left before the idle period ends by calling <code class="language-text">deadline.timeRemaining()</code>. The maximium amount of idle time is 50ms, but most of the times we’ll get less time than that depending on how busy the CPU is. Using the timeRemaining and a constant max time for each calculation we can check if we have free time to do one more calc or reschedule to the next idle period. We’ll schedule a new callback until there are no more tasks to execute. By processing our cells this way, we make sure to not interrupt latency-critical events and provide a smooth user experience. </p>
<p>If we’re processing 100 calcs, the time to execution with idle does not vary much from the regular blocking operation, but if we’re processing 100 000, the idle approach will take longer, but smoother. Its a tradeoff, that personally, I think its worth it. </p>
<p>There is though, a caveat, the <a href="https://caniuse.com/#search=requestIdle">browser support</a> is not yet ideal… Its not yet supported by neither IE Edge or safari… Always those two, right? <img class="emoji-icon" data-icon="emoji-disappointed" style="display: inline; margin: 0; margin-top: 1px; position: relative; top: 5px; width: 25px" src="data:image/png;base64, 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"> There are ways to shim it, such as this simple <a href="https://gist.github.com/paullewis/55efe5d6f05434a96c36">gist</a> and <a href="https://github.com/facebook/react/blob/master/packages/scheduler/src/Scheduler.js#L415">react’s approach</a>, which is a more complex and robust.</p>
<h1>Lets code!</h1>
<p>First we need to create a dummy function that will represent our cell computation, lets call it <code class="language-text">performUnitOfWork</code> (It’s pretty much hardcoded and does not reflect the real world code): </p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">isFormula</span> <span class="token operator">=</span> value <span class="token operator">=></span> 
  <span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">'string'</span> <span class="token operator">&amp;&amp;</span> value<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">performUnitOfWork</span><span class="token punctuation">(</span>nextUnitOfWork<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> formula <span class="token punctuation">}</span> <span class="token operator">=</span> nextUnitOfWork<span class="token punctuation">.</span>task<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isFormula</span><span class="token punctuation">(</span>formula<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> parentId <span class="token operator">=</span> formula<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/A\d*/</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// hardcoded stuff</span>
        <span class="token keyword">const</span> previousValue <span class="token operator">=</span> spreadsheet<span class="token punctuation">.</span>data<span class="token punctuation">[</span>parentId<span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token keyword">const</span> newValue <span class="token operator">=</span> previousValue <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span>
        spreadsheet<span class="token punctuation">.</span>data<span class="token punctuation">[</span>nextUnitOfWork<span class="token punctuation">.</span>task<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> newValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>nextUnitOfWork<span class="token punctuation">.</span>task<span class="token punctuation">.</span>child<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">/** 
     * Keeping the triggerId will allow us to know at all times 
     * which cell triggered the current computation
     */</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> 
      triggerId<span class="token punctuation">:</span> nextUnitOfWork<span class="token punctuation">.</span>triggerId<span class="token punctuation">,</span> 
      task<span class="token punctuation">:</span> spreadsheet<span class="token punctuation">.</span>data<span class="token punctuation">[</span>nextUnitOfWork<span class="token punctuation">.</span>task<span class="token punctuation">.</span>child<span class="token punctuation">]</span> 
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>This function extracts the id of the cell in the formula, adds 10 to the value of the referred cell, updates the current cell value and returns the next cell.</p>
<p>The following snippet shows how we would process our test data with a regular <code class="language-text">while</code> loop:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> task <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> nextUnitOfWork <span class="token operator">=</span> <span class="token punctuation">{</span> trigger<span class="token punctuation">:</span> task<span class="token punctuation">.</span>id<span class="token punctuation">,</span> task <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>nextUnitOfWork<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      nextUnitOfWork <span class="token operator">=</span> <span class="token function">performUnitOfWork</span><span class="token punctuation">(</span>nextUnitOfWork<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>To process the same data with a <code class="language-text">requestIdleCallback</code> scheduler, the code would be a bit more complex:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">/**
 * How long we think that we need to have to be able 
 * to process a single unit of work
 * We might need to tweak this.
 */</span>
<span class="token keyword">const</span> <span class="token constant">ENOUGH_TIME</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// in ms</span>
<span class="token keyword">let</span> workQueue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> nextUnitOfWork <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">resetNextUnitOfWork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> task <span class="token operator">=</span> workQueue<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>task<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

  nextUnitOfWork <span class="token operator">=</span> <span class="token punctuation">{</span> triggerId<span class="token punctuation">:</span> task<span class="token punctuation">.</span>id<span class="token punctuation">,</span> task <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">workLoop</span><span class="token punctuation">(</span>deadline<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>nextUnitOfWork<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">resetNextUnitOfWork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">while</span> <span class="token punctuation">(</span>nextUnitOfWork <span class="token operator">&amp;&amp;</span> deadline<span class="token punctuation">.</span><span class="token function">timeRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token constant">ENOUGH_TIME</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    nextUnitOfWork <span class="token operator">=</span> <span class="token function">performUnitOfWork</span><span class="token punctuation">(</span>nextUnitOfWork<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">performWork</span><span class="token punctuation">(</span>deadline<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">workLoop</span><span class="token punctuation">(</span>deadline<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>nextUnitOfWork <span class="token operator">||</span> workQueue<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">requestIdleCallback</span><span class="token punctuation">(</span>performWork<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">scheduleWork</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/** 
   * Verify if there is already a work being 
   * process that was triggered by the same cell
   */</span>
  <span class="token keyword">const</span> isInProgress <span class="token operator">=</span> 
    nextUnitOfWork <span class="token operator">&amp;&amp;</span> 
    nextUnitOfWork<span class="token punctuation">.</span>triggerId <span class="token operator">===</span> task<span class="token punctuation">.</span>id<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>isInProgress<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    nextUnitOfWork <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  workQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">requestIdleCallback</span><span class="token punctuation">(</span>performWork<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>To start processing our test data we call scheduleWork with a task. A task represents a cell that has been changed and requires our computation module to perform calculations.</p>
<p>First we need to check if there is a work in progress that was triggered by the same cell that we were passed, if so that should be interrupted and added back to the end of the workQueue. After updating the queue, a performWork callback is scheduled with the <strong>requestIdleCallback</strong>.</p>
<p>When we get a slot of idle cpu time, the function <strong>performWork</strong> is called. This function calls the <strong>workLoop</strong> which is responsible to get the next task in the workQueue and then do a while loop calling <strong>performUnitOfWork</strong> while it still has time left in the idle period. </p>
<p>The <strong>performUnitOfWork</strong> computes the cell value and returns the next cell to be computed which gets assigned to the <strong>nextUnitOfWork</strong>. </p>
<p>Once there is no more time to process cells, the performWork function will schedule a <strong>requestIdleCallback</strong> to pickup the work on the next cpu idle time.</p>
<p>This loop will keep going on until there are no more nextUnitOfWork or items in the workQueue.</p>
<h1>Results</h1>
<p>The blocking iteration approach is much faster to execute, but, as visible in <strong>fig. 1</strong> it has a lot of drop frames. The page would be unresponsive for a second there. The idle callback approach takes longer to execute, its time of execution is not predictable as it depends on how busy the CPU is, but the page is responsive at all times (<strong>fig. 2</strong>) and therefore the perceived performance might be much better.</p>
<div class="gallery">
  <div class="gallery__item">
    <img src="/blog/regular-radar-only-e38b913c481a88a368c2d2506b584554.gif">
    <label><strong>fig. 1:</strong> with while loop</label>
  </div>
  <div class="gallery__item">
    <img src="/blog/idle-radar-only-302b9a609f2bf8289228abbb0fe1145b.gif">
    <label><strong>fig. 2:</strong> with idle callback</label>
  </div>
</div>
<h1>Conclusion</h1>
<p>In this isolated test it seems that the approach with <strong>requestIdleCallback</strong> checks our requirements.</p>
<p>But, there are a few topics that will require further exploration:</p>
<ul>
<li>How well does this work integrated with react’s scheduler?</li>
<li>According to <a href="https://twitter.com/sebmarkbage/status/822881464794497024">@sebmarkbage</a> most requestIdleCallback shims are not a accurate representation of what requestIdleCallback should do. Can we find a good shim or even use the one that react uses?</li>
<li>Can we limit our FE computations to cells that are in the viewport (or close by) and at the same time provide a good UX?</li>
</ul>
<p>You can check this <a href="https://github.com/canastro/heavy-fe-computation">github repo</a> with all the approaches that we’ll try out before a final decision is taken.</p>
<p><em><strong>Disclaimer:</strong> Opinions are my own and not the views of my employer.</em></p>
<p><em>If you find any error, be it on my poor english or any technical detail, please don’t be shy. I’ll try to continuously improve this blog post <img class="emoji-icon" data-icon="emoji-simple_smile" style="display: inline; margin: 0; margin-top: 1px; position: relative; top: 5px; width: 25px" src="data:image/png;base64, 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"></em></p></div><style data-emotion-css="1kvusmz">.css-1kvusmz{margin-bottom:1.75rem;}</style><hr class="css-1kvusmz"/><style data-emotion-css="1qfxf3w">.css-1qfxf3w{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;list-style:none;padding:0;}</style><ul class="css-1qfxf3w"><li><a rel="prev" href="/blog/2019-01-09---ts-extend-modify/">← <!-- -->Typescript - Extending and modifying existing types with Mapped Types</a></li><li></li></ul></div></div></div><script>
  
  function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='UA-110924562-1',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-110924562-1', 'auto', {});
      ga('set', 'anonymizeIp', true);
      
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-js","jsonName":"offload-heavy-browser-computation-1b0","path":"/offload-heavy-browser-computation"};window.dataPath="252/path---offload-heavy-browser-computation-1-b-0-1da-hY1QFXnplce0NeeIM5Xjj5FZmQM";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app.74bdf83e79269eca4caf.css","/app-71bb5c1e51537a9caa47.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-a68591703eee7bb02bca.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js.29ce2abb0b0bffc87cdf.css","/component---src-templates-blog-post-js-dfae161cbd4cc5cee727.js"],"component---src-templates-tags-js":["/component---src-templates-tags-js.29ce2abb0b0bffc87cdf.css","/component---src-templates-tags-js-e526b40d01d87fedb2d3.js"],"component---src-pages-404-js":["/component---src-pages-404-js.29ce2abb0b0bffc87cdf.css","/component---src-pages-404-js-ff27a3cf335a8c574832.js"],"component---src-pages-index-js":["/component---src-pages-index-js-77b08483bbf6d8b09501.js"],"component---src-pages-tags-js":["/component---src-pages-tags-js-9daa1fefb659743c41a2.js"],"pages-manifest":["/pages-manifest-2bfeae8159ad14da040b.js"]};/*]]>*/</script><script src="/blog/webpack-runtime-34eb4a7240d1c4477f59.js" async=""></script><script src="/blog/app-71bb5c1e51537a9caa47.js" async=""></script><script src="/blog/component---src-templates-blog-post-js-dfae161cbd4cc5cee727.js" async=""></script><script src="/blog/0-e48695d5871324b71e93.js" async=""></script></body></html>