{"data":{"site":{"siteMetadata":{"title":"Canastro's notes","author":"Ricardo Canastro"}},"markdownRemark":{"id":"53cebb79-18de-5592-8930-9d060d1eef59","excerpt":"What is Flow? Flow is a static type checker for javascript that allows you to: Code  faster : Flow identifies problems as you code. Stop wasting your timeâ€¦","html":"<h1>What is Flow?</h1>\n<p>Flow is a static type checker for javascript that allows you to:</p>\n<ul>\n<li>Code <strong>faster</strong>: Flow identifies problems as you code. Stop wasting your time guessing and checking;</li>\n<li>Code <strong>smarter</strong>: Flow understands your code and makes its knowledge available, enabling other smart tools to be built on top of Flow;</li>\n<li>Code <strong>confidently</strong>: Flow helps you refactor safely;</li>\n<li>Code <strong>bigger</strong>: Flow can help prevent bad rebases. Flow can help protect your carefully designed library from your coworkers. And Flow can help you understand the code you wrote six months ago.</li>\n</ul>\n<p>Text <em>extracted</em> from <em><a href=\"flow.org\">flow.org</a></em></p>\n<h1>What is Flow Runtime?</h1>\n<p>Some type errors cannot be detected on compilation time but only on runtime, flow-runtime annotates your code with assertations to validate types. Imagine the following code:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> getValue <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">:</span> Object<span class=\"token punctuation\">,</span> shouldParse<span class=\"token punctuation\">:</span> boolean<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> number <span class=\"token operator\">=></span>\n    shouldParse <span class=\"token operator\">?</span> <span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> input<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span></code></pre></div>\n<p>If the <code class=\"language-text\">input.value</code> is a string and the <code class=\"language-text\">shouldParse</code> is passed as <code class=\"language-text\">false</code> then the output of the given function is a string. This type error can only be detected in runtime.</p>\n<p>This code when compiled and annotated with flow-runtime validations is something like this: </p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> getValue <span class=\"token operator\">=</span> _flowRuntime2<span class=\"token punctuation\">.</span><span class=\"token keyword\">default</span><span class=\"token punctuation\">.</span><span class=\"token function\">annotate</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">,</span> shouldParse<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> _inputType <span class=\"token operator\">=</span> _flowRuntime2<span class=\"token punctuation\">.</span><span class=\"token keyword\">default</span><span class=\"token punctuation\">.</span><span class=\"token function\">object</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> _shouldParseType <span class=\"token operator\">=</span> _flowRuntime2<span class=\"token punctuation\">.</span><span class=\"token keyword\">default</span><span class=\"token punctuation\">.</span><span class=\"token function\">boolean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> _returnType2 <span class=\"token operator\">=</span> _flowRuntime2<span class=\"token punctuation\">.</span><span class=\"token keyword\">default</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">return</span><span class=\"token punctuation\">(</span>_flowRuntime2<span class=\"token punctuation\">.</span><span class=\"token keyword\">default</span><span class=\"token punctuation\">.</span><span class=\"token function\">number</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    _flowRuntime2<span class=\"token punctuation\">.</span><span class=\"token keyword\">default</span><span class=\"token punctuation\">.</span><span class=\"token function\">param</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">,</span> _inputType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">assert</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    _flowRuntime2<span class=\"token punctuation\">.</span><span class=\"token keyword\">default</span><span class=\"token punctuation\">.</span><span class=\"token function\">param</span><span class=\"token punctuation\">(</span><span class=\"token string\">'shouldParse'</span><span class=\"token punctuation\">,</span> _shouldParseType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">assert</span><span class=\"token punctuation\">(</span>shouldParse<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> _returnType2<span class=\"token punctuation\">.</span><span class=\"token function\">assert</span><span class=\"token punctuation\">(</span>shouldParse <span class=\"token operator\">?</span> <span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> input<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> _flowRuntime2<span class=\"token punctuation\">.</span><span class=\"token keyword\">default</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>\n    _flowRuntime2<span class=\"token punctuation\">.</span><span class=\"token keyword\">default</span><span class=\"token punctuation\">.</span><span class=\"token function\">param</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">,</span> _flowRuntime2<span class=\"token punctuation\">.</span><span class=\"token keyword\">default</span><span class=\"token punctuation\">.</span><span class=\"token function\">object</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    _flowRuntime2<span class=\"token punctuation\">.</span><span class=\"token keyword\">default</span><span class=\"token punctuation\">.</span><span class=\"token function\">param</span><span class=\"token punctuation\">(</span><span class=\"token string\">'shouldParse'</span><span class=\"token punctuation\">,</span> _flowRuntime2<span class=\"token punctuation\">.</span><span class=\"token keyword\">default</span><span class=\"token punctuation\">.</span><span class=\"token function\">boolean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    _flowRuntime2<span class=\"token punctuation\">.</span><span class=\"token keyword\">default</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">return</span><span class=\"token punctuation\">(</span>_flowRuntime2<span class=\"token punctuation\">.</span><span class=\"token keyword\">default</span><span class=\"token punctuation\">.</span><span class=\"token function\">number</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>In case of type mismatch, the <code class=\"language-text\">_returnType2.assert</code> calls will throw a error. In this case, if the <code class=\"language-text\">shouldParse</code> is false and the <code class=\"language-text\">input.value</code> is a string then, the following error would be thrown:</p>\n<div class=\"gatsby-highlight\" data-language=\"error\"><pre class=\"language-error\"><code class=\"language-error\">Uncaught TypeError: Return Type must be a number\nExpected: number\nActual Value: &quot;test-string&quot;\nActual Type: string</code></pre></div>\n<h1>Flow &#x26; flow-runtime annotations in production builds?</h1>\n<p>No, no, definitely not! All flow and flow-runtime annotations should be removed for a production build.</p>\n<p><code class=\"language-text\">babel-plugin-transform-flow-strip-types</code> module will remove all flow annotations and <code class=\"language-text\">babel-plugin-flow-runtime</code> should only be configured for the <code class=\"language-text\">development</code> environment.</p>\n<p>Following a configuration similar with this, we will achieve a bundle clean of any flow annotation:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"presets\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">[</span><span class=\"token string\">\"env\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token property\">\"targets\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token property\">\"browsers\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"IE >= 11\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"plugins\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"transform-flow-strip-types\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"env\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"development\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"plugins\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">[</span><span class=\"token string\">\"flow-runtime\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"assert\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"annotate\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h1>How to validate flow types on build?</h1>\n<p>In order to have flow type errors during build process you shoud install <code class=\"language-text\">babel-plugin-flow-runtime</code> and add the plugin to your <code class=\"language-text\">webpack.config.js</code> file.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> FlowBabelWebpackPlugin <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'flow-babel-webpack-plugin'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n\tentry<span class=\"token punctuation\">:</span> <span class=\"token string\">'./entry.js'</span><span class=\"token punctuation\">,</span>\n\toutput<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n\t\tpath<span class=\"token punctuation\">:</span> __dirname<span class=\"token punctuation\">,</span>\n\t\tfilename<span class=\"token punctuation\">:</span> <span class=\"token string\">'bundle.js'</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\tmodule<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n\t\tloaders<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n\t\t\t<span class=\"token punctuation\">{</span> test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.js$/</span><span class=\"token punctuation\">,</span> loader<span class=\"token punctuation\">:</span> <span class=\"token string\">'babel-loader'</span> <span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">]</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\tplugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">FlowBabelWebpackPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h1>Setup a playground</h1>\n<p>Lets setup a dummy project just to get you started with flow.</p>\n<blockquote>\n<p>If you, like me, prefer to see code instead of steps to achieve the final goal, check  a dummy project here: <a href=\"https://github.com/canastro/flow-runtime-demo\">flow-runtime-demo</a></p>\n</blockquote>\n<ol>\n<li>Install dependencies</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm i -g webpack\n\nnpm i -D babel-cli babel-core\nnpm i -D babel-loader babel-preset-env\n\nnpm i -D flow-runtime\nnpm i -D babel-preset-env babel-plugin-flow-runtime\nnpm i -D babel-plugin-transform-flow-strip-types  \nnpm i -D flow-babel-webpack-plugin</code></pre></div>\n<ol start=\"2\">\n<li>\n<p>Create a .babelrc file (as explained above)</p>\n</li>\n<li>\n<p>Create a webpack.config.js file (as explained above)</p>\n</li>\n<li>\n<p>Create your entry.js (or whatever you want to call it) and index.html files</p>\n</li>\n<li>\n<p>Add flow stuff!</p>\n</li>\n</ol>\n<p>Here you go, you have simple setup of webpack + flow + flow-runtime, now go bananas and make something useful!</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a80f143312ffdc7747813e88edfc0227/32589/go-go-bananas.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 320px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 150%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAeABQDASIAAhEBAxEB/8QAGQAAAwADAAAAAAAAAAAAAAAAAAMEAQIF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQIA/9oADAMBAAIQAxAAAAFmOomdUbDpFUyS2jCj/8QAHRAAAgICAwEAAAAAAAAAAAAAAQIAEgMhERMUMv/aAAgBAQABBQJvQXPfF+WNArGomzBs4t46WiJyRof/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAXEQADAQAAAAAAAAAAAAAAAAAAARAx/9oACAECAQE/ARZEf//EACIQAAIBAgUFAAAAAAAAAAAAAAABEQIhEBITImExM0FRkf/aAAgBAQAGPwJ9yOC2r9EP34N6eFbncmRU5sJmaXS+BX6og//EABwQAQACAwEBAQAAAAAAAAAAAAEAESFBUTFhgf/aAAgBAQABPyGolruncQM8F6J2XjcxvKzFVsYfGKyyKYq0BoJk0Vvv7F9IiHXobSuK9UuGtVjk/9oADAMBAAIAAwAAABAfI/7/xAAYEQACAwAAAAAAAAAAAAAAAAAAARARIf/aAAgBAwEBPxCowZ//xAAYEQADAQEAAAAAAAAAAAAAAAAAARExIf/aAAgBAgEBPxCuZ0wExIof/8QAHxABAAICAwADAQAAAAAAAAAAAREhADFBUWFxgaHB/9oACAEBAAE/EKoM9B4eRg8KFfxzibmwC7L7izNgIuXE2AbEQR1h8Z28+4CZKKhECe7nGyLzDy38PrLWmNvvn9xys0rodjTk3MaYBRKriHWOAMIAwBxn/9k='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Go Bananas\"\n        title=\"\"\n        src=\"/static/a80f143312ffdc7747813e88edfc0227/32589/go-go-bananas.jpg\"\n        srcset=\"/static/a80f143312ffdc7747813e88edfc0227/b04cf/go-go-bananas.jpg 148w,\n/static/a80f143312ffdc7747813e88edfc0227/29bf1/go-go-bananas.jpg 295w,\n/static/a80f143312ffdc7747813e88edfc0227/32589/go-go-bananas.jpg 320w\"\n        sizes=\"(max-width: 320px) 100vw, 320px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h1>Resources</h1>\n<ul>\n<li><a href=\"https://flow.org/\">flow</a></li>\n<li><a href=\"https://codemix.github.io/flow-runtime/#/\">flow-runtime</a></li>\n<li><a href=\"https://github.com/canastro/flow-runtime-demo\">flow-runtime-demo</a></li>\n</ul>","frontmatter":{"title":"With the Power of Flow Runtime!","subtitle":null,"date":"December 08, 2017"}}},"pageContext":{"tags":[{"text":"dev environment","link":"/tags/dev-environment/"},{"text":"flowjs","link":"/tags/flowjs/"}],"slug":"/2017-12-08---power-of-flow-runtime/","previous":{"fields":{"slug":"/2017-12-07---eslint-configuration/"},"frontmatter":{"title":"ESLint Configurations - Your Project, Your Rules!","path":"/2017-12-07---eslint-configuration","tags":["dev environment","eslint"]}},"next":{"fields":{"slug":"/2017-12-09---speedtracker/"},"frontmatter":{"title":"SpeedTracker - Periodic Performance Tests","path":"/2017-12-09---speedtracker","tags":["performance"]}}}}